<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<style>
			.c-quote {
				max-width: 800px;
				margin: 0 auto;

				font-size: 16px;
				line-height: 1.7;
			}
			.c-quote__column {
				display: flex;
				justify-content: space-between;
				align-items: flex-end;
				gap: 24px;
			}
			.c-quote__label {
				width: 100%;
				max-width: 340px;
				display: flex;
				justify-content: space-between;
				gap: 14px;
			}
			.c-quote__title {
			}
			.c-quote__unit {
			}
			.c-quote__input {
				width: 108px;
				font-size: 18px;
				font-weight: bold;
				height: 100%;
				padding: 4px 4px 4px 8px;
				border: none;
				border-bottom: solid 1px #333;

				outline: none;
			}
			.c-quote__input:focus {
				border-bottom: solid 1px #f00;
			}
			.c-quote__price {
				display: flex;
				justify-content: space-between;
				align-items: flex-end;
				width: 100px;
				/* margin: 0 0 0 auto; */
				padding: 4px;
				border-bottom: solid 1px #333;
			}

			.c-quote__option {
			}
			.c-quote__optionLabel {
				display: block;
			}
			.c-quote__optionPrice {
				margin: 0 0 0 auto;
			}

			.c-quote-total {
				display: flex;
				justify-content: flex-end;
				align-items: flex-end;
			}
			@media (max-width: 640px) {
				.c-quote-calculation {
					display: flex;
					flex-direction: column;
					gap: 40px;
				}
				.c-quote__column {
					/* flex-direction: column; */
					flex-wrap: wrap;
					gap: 8px;
				}
			}
		</style>

		<!--  -->
		<article class="c-quote" id="js-quote">
			<div class="c-quote-calculation js-quote-tbl">
				<div
					id="js-quote-item-1"
					class="js-quote-item c-quote__column"
					data-itemnum="1"
				>
					<label class="c-quote__label" for="main-design">
						<div class="c-quote__title item-name">メインページのデザイン</div>
						<div class="c-quote__unit item-name">¥50000/ページ</div>
					</label>
					<!-- <div class="item-quantity"> -->
					<input type="hidden" class="unit-price" value="50000" /><input
						type="number"
						id="main-design"
						class="text-quantity c-quote__input"
						placeholder="数値を入力"
						data-itemnum="1"
						value="1"
						min="0"
						max="5"
					/>
					<!-- </div> -->
					<div class="item-price c-quote__price">￥<span></span></div>
				</div>
				<div
					id="js-quote-item-2"
					class="js-quote-item c-quote__column"
					data-itemnum="2"
				>
					<label class="c-quote__label" for="main-cording">
						<div class="c-quote__title item-name">メインページの実装</div>
						<div class="c-quote__unit item-name">¥100000/ページ</div>
					</label>
					<!-- <div class="item-quantity"> -->
					<input type="hidden" class="unit-price" value="100000" /><input
						type="number"
						id="main-cording"
						class="text-quantity c-quote__input"
						placeholder="数値を入力"
						data-itemnum="2"
						value="1"
						min="0"
						max="5"
					/>
					<!-- </div> -->
					<div class="item-price c-quote__price">￥<span></span></div>
				</div>
				<div
					id="js-quote-item-3"
					class="js-quote-item c-quote__column"
					data-itemnum="3"
				>
					<label class="c-quote__label" for="sub-design">
						<div class="c-quote__title item-name">子ページのデザイン</div>
						<div class="c-quote__unit item-name">¥30000/ページ</div>
					</label>
					<!-- <div class="item-quantity"> -->
					<input type="hidden" class="unit-price" value="30000" /><input
						type="number"
						id="sub-design"
						class="text-quantity c-quote__input"
						placeholder="数値を入力"
						data-itemnum="3"
						value="1"
						min="0"
						max="20"
					/>
					<!-- </div> -->
					<div class="item-price c-quote__price">￥<span></span></div>
				</div>
				<div
					id="js-quote-item-4"
					class="js-quote-item c-quote__column"
					data-itemnum="4"
				>
					<label class="c-quote__label" for="sub-cording">
						<div class="c-quote__title item-name">子ページの実装</div>
						<div class="c-quote__unit item-name">¥50000/ページ</div>
					</label>
					<!-- <div class="item-quantity"> -->
					<input type="hidden" class="unit-price" value="50000" /><input
						type="number"
						id="sub-cording"
						class="text-quantity c-quote__input"
						placeholder="数値を入力"
						data-itemnum="4"
						value="1"
						min="0"
						max="20"
					/>
					<!-- </div> -->
					<div class="item-price c-quote__price">￥<span></span></div>
				</div>
				<div
					id="js-quote-item-5"
					class="js-quote-item c-quote__option"
					data-itemnum="5"
				>
					<h3 class="item-name">オプション</h3>
					<!-- <div class="item-quantity" colspan="2"> -->
					<label class="c-quote__optionLabel"
						><input
							type="checkbox"
							class="check-quantity"
							data-itemnum="5"
							value="5000"
						/>サーバー・ドメインのセットアップ（¥5000）</label
					>
					<label class="c-quote__optionLabel"
						><input
							type="checkbox"
							class="check-quantity"
							data-itemnum="5"
							value="10000"
						/>WordPressへの組み込み（¥10000）</label
					>
					<label class="c-quote__optionLabel"
						><input
							type="checkbox"
							class="check-quantity"
							data-itemnum="5"
							value="5000"
						/>Wraptasへの組み込み（¥5000）</label
					>
					<label class="c-quote__optionLabel"
						><input
							type="checkbox"
							class="check-quantity"
							data-itemnum="5"
							value="5000"
						/>問い合わせフォームの実装（¥5000）</label
					>
					<!-- </div> -->
					<div class="item-price c-quote__price c-quote__optionPrice">
						￥<span></span>
					</div>
				</div>
			</div>
			<dl class="c-quote-total js-quote-total-tbl" data-taxflg="0">
				<dt class="c-quote__title">合計金額</dt>
				<dd class="c-quote__price">￥<span id="js-quote-total"></span></dd>
			</dl>
		</article>
		<!--  -->

		<script>
			"use strict";

			window.onload = function () {
				var textQuantityElems = document.querySelectorAll(
					"#js-quote .text-quantity"
				);
				textQuantityElems = Array.prototype.slice.call(textQuantityElems, 0);
				textQuantityElems.forEach(function (
					textQuantityElem,
					textQuantityIndex
				) {
					if (textQuantityElem.value != "") textQuantityElem.value = "";
					textQuantityElem.addEventListener("keyup", calcPrice, false);
					textQuantityElem.addEventListener("blur", calcPrice, false);
				});
				var radioQuantityElems = document.querySelectorAll(
					"#js-quote .radio-quantity"
				);
				radioQuantityElems = Array.prototype.slice.call(radioQuantityElems, 0);
				radioQuantityElems.forEach(function (
					radioQuantityElem,
					radioQuantityIndex
				) {
					if (radioQuantityElem.checked) radioQuantityElem.checked = false;
					radioQuantityElem.addEventListener("change", calcPrice, false);
				});
				var checkQuantityElems = document.querySelectorAll(
					"#js-quote .check-quantity"
				);
				checkQuantityElems = Array.prototype.slice.call(checkQuantityElems, 0);
				checkQuantityElems.forEach(function (
					checkQuantityElem,
					checkQuantityIndex
				) {
					if (checkQuantityElem.checked) checkQuantityElem.checked = false;
					checkQuantityElem.addEventListener("change", calcPrice, false);
				});
				var selectQuantityElems = document.querySelectorAll(
					"#js-quote .select-quantity"
				);
				selectQuantityElems = Array.prototype.slice.call(
					selectQuantityElems,
					0
				);
				selectQuantityElems.forEach(function (
					selectQuantityElem,
					selectQuantityIndex
				) {
					selectQuantityElem.selectedIndex = 0;
					selectQuantityElem.addEventListener("change", calcPrice, false);
				});

				function calcPrice() {
					var subtotal = 0,
						tax = 0,
						total = 0,
						itemNum = event.target.getAttribute("data-itemnum"),
						taxFlg = parseInt(
							document
								.querySelector(".js-quote-total-tbl")
								.getAttribute("data-taxflg")
						),
						items = document.querySelectorAll(".js-quote-item");
					items = Array.prototype.slice.call(items, 0);
					items.forEach(function (itemElem, itemIndex) {
						if (itemElem.getAttribute("data-itemnum") == itemNum) {
							if (event.target.classList.contains("text-quantity")) {
								itemElem.querySelector(".item-price span").textContent =
									escapeHtml(event.target.value) *
									escapeHtml(itemElem.querySelector(".unit-price").value);
							} else if (event.target.classList.contains("radio-quantity")) {
								itemElem.querySelector(".item-price span").textContent =
									escapeHtml(event.target.value);
							} else if (event.target.classList.contains("check-quantity")) {
								var checkLabels = itemElem.querySelectorAll(".check-quantity");
								var _total = 0;
								checkLabels = Array.prototype.slice.call(checkLabels, 0);
								checkLabels.forEach(function (checkLabelElem, checkLabelIndex) {
									if (checkLabelElem.checked) {
										_total += parseInt(escapeHtml(checkLabelElem.value));
									}
								});
								itemElem.querySelector(".item-price span").textContent = _total;
							} else if (event.target.classList.contains("select-quantity")) {
								itemElem.querySelector(".item-price span").textContent =
									escapeHtml(itemElem.querySelector(".select-quantity").value);
							}
						}

						if (itemElem.querySelector(".item-price span").textContent != "") {
							subtotal += parseInt(
								itemElem.querySelector(".item-price span").textContent
							);
						}
					});

					if (taxFlg == 1) {
						tax =
							subtotal *
							(parseInt(
								document.querySelector("#js-quote-tax-rate").textContent
							) /
								100);
						tax = Math.floor(tax);
						document.querySelector("#js-quote-subtotal").textContent = subtotal;
						document.querySelector("#js-quote-tax").textContent = tax;
						document.querySelector("#js-quote-total").textContent =
							subtotal + tax;
					} else {
						document.querySelector("#js-quote-total").textContent = subtotal;
					}

					var outputContents = document.querySelectorAll(
						"textarea.js-quote-output"
					);
					outputContents = Array.prototype.slice.call(outputContents, 0);
					outputContents.forEach(function (outputElem, outputIndex) {
						var outputHtml = "",
							mjItems = document.querySelectorAll(".js-quote-item"),
							mjTotalItems = document.querySelectorAll(
								".js-quote-total-tbl tr"
							);
						mjItems = Array.prototype.slice.call(mjItems, 0);
						mjItems.forEach(function (mjElem, mjIndex) {
							var txtItemName = mjElem.querySelector(".item-name").textContent,
								txtItemPrice = mjElem.querySelector(".item-price").textContent;
							if (mjElem.querySelector(".unit-price") != null) {
								var valUnitPrice = escapeHtml(
										mjElem.querySelector(".unit-price").value
									),
									valTextQuantity = escapeHtml(
										mjElem.querySelector(".text-quantity").value
									);
								if (valUnitPrice != "" && valTextQuantity != "") {
									outputHtml += txtItemName;
									outputHtml +=
										"（￥" + valUnitPrice + " × " + valTextQuantity + "）";
									outputHtml += "： " + txtItemPrice + "\n";
								}
							}
							if (mjElem.querySelector(".radio-quantity") != null) {
								var radioItems = mjElem.querySelectorAll(".radio-quantity");
								radioItems = Array.prototype.slice.call(radioItems, 0);
								radioItems.forEach(function (radioElem, radioIndex) {
									if (radioElem.checked) {
										var txtRadioItemName = radioElem.parentNode.textContent,
											valRadioQuantity = escapeHtml(radioElem.value);
										if (valRadioQuantity != "") {
											outputHtml += txtItemName;
											outputHtml +=
												"（" +
												txtRadioItemName +
												" ￥" +
												valRadioQuantity +
												"）";
											outputHtml += "： " + txtItemPrice + "\n";
										}
									}
								});
							}
							if (mjElem.querySelector(".check-quantity") != null) {
								var checkItems = mjElem.querySelectorAll(".check-quantity");
								checkItems = Array.prototype.slice.call(checkItems, 0);
								var checkItemFlg = false,
									checkItemContents = "";
								checkItems.forEach(function (checkElem, checkIndex) {
									if (checkElem.checked) {
										var txtCheckItemName = checkElem.parentNode.textContent,
											valCheckQuantity = escapeHtml(checkElem.value);
										if (valCheckQuantity != "") {
											if (!checkItemFlg) {
												checkItemContents +=
													txtCheckItemName + "：￥" + valCheckQuantity;
											} else {
												checkItemContents +=
													", " + txtCheckItemName + "：￥" + valCheckQuantity;
											}
										}
										checkItemFlg = true;
									}
								});
								if (checkItemFlg) {
									outputHtml += txtItemName + "\n";
									outputHtml += "（" + checkItemContents + "）\n";
									outputHtml += "： " + txtItemPrice + "\n";
								}
							}
							if (mjElem.querySelector(".select-quantity") != null) {
								var optItems = mjElem.querySelectorAll(
									".select-quantity option"
								);
								optItems = Array.prototype.slice.call(optItems, 0);
								optItems.forEach(function (optElem, optIndex) {
									if (optElem.selected) {
										var txtOptName = optElem.textContent,
											valOpt = escapeHtml(optElem.value);
										if (valOpt != "") {
											outputHtml += txtItemName;
											outputHtml += "（" + txtOptName + " ￥" + valOpt + "）";
											outputHtml += "： " + txtItemPrice + "\n";
										}
									}
								});
							}
						});
						outputHtml += "\n\n";
						mjTotalItems = Array.prototype.slice.call(mjTotalItems, 0);
						mjTotalItems.forEach(function (mjtElem, mjtIndex) {
							outputHtml +=
								mjtElem.querySelector("th").textContent +
								mjtElem.querySelector("td").textContent +
								"\n";
						});
						outputElem.textContent = outputHtml;
					});
				}

				function escapeHtml(str) {
					str = str.replace(/&/g, "&amp;");
					str = str.replace(/</g, "&lt;");
					str = str.replace(/>/g, "&gt;");
					str = str.replace(/"/g, "&quot;");
					str = str.replace(/'/g, "&#39;");
					return str;
				}
			};
		</script>
	</body>
</html>
