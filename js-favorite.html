<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<ul>
			<li no="1" class="js-favorite-add" onclick="favorite_add('1')">
				<span>♡</span>No:1 りんご
			</li>
			<li no="1" class="js-favorite-remove" onclick="favorite_remove('1')">
				<span>♥</span>No:1 りんご
			</li>
			<li no="2" class="js-favorite-add" onclick="favorite_add('2')">
				<span>♡</span>No:2 みかん
			</li>
			<li no="2" class="js-favorite-remove" onclick="favorite_remove('2')">
				<span>♥</span>No:2 みかん
			</li>
			<li no="3" class="js-favorite-add" onclick="favorite_add('3')">
				<span>♡</span>No:3 ばなな
			</li>
			<li no="3" class="js-favorite-remove" onclick="favorite_remove('3')">
				<span>♥</span>No:3 ばなな
			</li>
		</ul>

		<style>
			ul li.js-favorite-remove span {
				color: #f00;
			}
		</style>

		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
		<script>
			/* 【解説Aパート】 "表示ソースの切り替え" */
			function togleitem(oid, event) {
				if (event == "add") {
					// 未チェック(class="add")を非表示にして、チェック済(class="remove")を表示する
					$("li.js-favorite-add[no=" + oid + "]").hide();
					$("li.js-favorite-remove[no=" + oid + "]").show();
				} else if (event == "remove") {
					// チェック済(class="remove")を非表示にして、未チェック(class="add")を表示する
					$("li.js-favorite-add[no=" + oid + "]").show();
					$("li.js-favorite-remove[no=" + oid + "]").hide();
				}
			}

			/* 【解説Bパート】 "ページロード時にローカルストレージの中をチェック" */
			$(function () {
				$("ul .js-favorite-remove").hide(); // お気に入り中の表示は一時的に非表示に。

				// お気に入りリストに存在するか確認
				const key = "お気に入りID";
				const getjson = localStorage.getItem(key);
				const oidlist = JSON.parse(getjson);
				if (oidlist != null) {
					oidlist.forEach(function (oid) {
						togleitem(oid, "add");
					});
				}
			});

			/* 【解説Cパート】 "お気に入りに追加機能" */
			function favorite_add(oid) {
				const key = "お気に入りID"; // キーの名前を指定

				// ローカルストレージから値を取得
				const getjson = localStorage.getItem(key);
				const oidlist = JSON.parse(getjson);

				if (oidlist == null) {
					// 初めて「お気に入りID」というキーがローカルストレージに登録される時の処理
					oidary = new Array(oid);
					const setjson = JSON.stringify(oidary);
					localStorage.setItem(key, setjson);

					togleitem(oid, "add");
				} else {
					// 既に「お気に入りID」というキーが存在する時
					if (oidlist.indexOf(oid) == -1) {
						// 且つ、まだお気に入りIDに登録されていない時
						oidlist.push(oid);
						const setjson = JSON.stringify(oidlist);
						localStorage.setItem(key, setjson);

						togleitem(oid, "add");
					}
				}
			}

			/* 【解説Dパート】 "お気に入りから削除機能" */
			function favorite_remove(oid) {
				const key = "お気に入りID"; // キーの名前を指定

				// ローカルストレージから値を取得
				const getjson = localStorage.getItem(key);
				const oidlist = JSON.parse(getjson);

				if (oidlist != null) {
					// 「お気に入りID」というキーが存在した時
					const checkitem = oidlist.indexOf(oid); // 配列の何番目に該当のIDがあるかを見る
					if (checkitem != -1) {
						// 「お気に入りID」の中に該当のIDが見つかった時
						oidlist.splice(checkitem, 1);
						const setjson = JSON.stringify(oidlist);
						localStorage.setItem(key, setjson);

						togleitem(oid, "remove");
					}
				}
			}
		</script>

		<!--  -->
		<style>
			.c-favorite_button {
				font-size: 24px;
				color: #fff;
				-webkit-text-stroke: 1px #333;
				border: none;
				background-color: #fff;
			}
			.c-favorite_button.is-bookmark {
				color: #f00;
				-webkit-text-stroke: 1px #f00;
			}
		</style>
		<button class="c-favorite_button js-favorite-button">♥</button>
		<script>
			$(".js-favorite-button").click(function () {
				$(".js-favorite-button").toggleClass("is-bookmark");
			});
			// localStorage.setItem(
			// 	"favorite-item",
			// 	$(".js-favorite-button").hasClass("is-bookmark")
			// );

			// $(".js-favorite-button").click(function () {
			// 	$(".js-favorite-button").toggleClass("is-bookmark");

			// 	localStorage.setItem(
			// 		"favorite-item",
			// 		$(".js-favorite-button").hasClass("is-bookmark")
			// 	);
			// });

			// // window.localStorage.setItem('keyname','内容です。');
			// if (window.localStorage.getItem("favorite-item")) {
			// 	$(".js-favorite-button").addClass("is-bookmarke");
			// }
			// if (localStorage.getItem("favorite-item") === "true") {
			// 	$(".js-favorite-button").addClass("is-bookmarke");
			// }
		</script>

		<script>
			// ウェブストレージに対応している場合
			if (window.localStorage) {
				// 保存するオブジェクト
				const obj = {
					str: "Hello",
				};
				// オブジェクトをjsonに変換
				const txt = JSON.stringify(obj);
				// jsonデータをlocalStorageに保存
				localStorage.setItem("hoge", txt);
				// localStorageに保存されたものをキーを指定して取得
				const item = localStorage.getItem("hoge");
				// コンソールに出力
				console.log(item);
			}
		</script>
	</body>
</html>
