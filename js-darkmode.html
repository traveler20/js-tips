<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Dark or light</title>
	</head>
	<style>
		/* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º */
		body {
			margin: 0;
			padding: 1em 2em;
			color: #aaae8d;
			background-color: #1d1d2c;
			transition-duration: 1s;
			transition-property: color, background-color;
		}
		.msg {
			font-size: 30px;
			font-weight: bold;
		}

		.dark {
			display: block;
		}
		.light {
			display: none;
		}

		/*â†‘ä¸€å¿œãƒ‡ãƒã‚¤ã‚¹ã®ãƒ†ãƒ¼ãƒã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šâ†“*/
		@media (prefers-color-scheme: light) {
			.dark {
				display: none;
			}
			.light {
				display: block;
			}
		}

		/* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ã¨ã */
		.js-mode-light {
			color: #000;
			background-color: whitesmoke;
		}
		.js-mode-light .light {
			display: block;
		}
		.js-mode-light .dark {
			display: none;
		}

		/* ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
		input[type="checkbox"] {
			display: none;
		}
		.switch {
			position: fixed;
			top: 0.5em;
			right: 0.5em;
			font-size: 60px;
		}
		.switch-label {
			cursor: pointer;
		}
		.switch-mode {
			position: absolute;
			top: -120px;
			right: -120px;
			display: block;
			width: 200px;
			height: 200px;
			transform: rotate(0);
			transition: transform 1s;
		}
		/* æœˆã¨å¤ªé™½ã‚’å¯¾è§’ç·šä¸Šã«è¨­ç½®ã—ã¦ãŠãã€‚
     è¨­å®šã—ãŸspanã‚’å›ã—ãŸã‚‰å¤ªé™½ãŒã²ã£ãã‚Šè¿”ã£ã¦ã—ã¾ã£ãŸã®ã§ã€transform scaleã§ä¸Šä¸‹åè»¢ã—ãŸ */
		.switch-mode::before {
			content: "ğŸŒ™";
			position: absolute;
			left: 0;
			bottom: 0;
		}
		.switch-mode::after {
			content: "ğŸŒ„";
			position: absolute;
			right: 0;
			top: 0;
			transform: scale(1, -1);
		}
	</style>
	<body>
		<!-- è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã¿ãŸã„è¦ç´   -->
		<!--light modeã ã‘ã§è¦‹ã›ãŸã„éƒ¨åˆ†-->
		<p class="msg light">light mode</p>
		<p class="msg light">ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼</p>
		<p class="msg light">æ˜ã‚‹ã„ã§ã™ã€‚</p>

		<!--dark modeã ã‘ã§è¦‹ã›ãŸã„éƒ¨åˆ†-->
		<p class="msg dark">dark mode</p>
		<p class="msg dark">ã“ã‚“ã°ã‚“ã¯ã€‚</p>
		<p class="msg dark">è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã§ã™ã€‚</p>

		<!--å…±é€šéƒ¨åˆ†-->
		<p class="msg">ã“ã‚“ã«ã¡ã¯ï¼</p>
		<p class="msg">ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦å¤‰åŒ–ã—ã¾ã™ã€‚</p>

		<!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã‚¹ã‚¤ãƒƒãƒ -->
		<div class="switch">
			<label class="switch-label">
				<input type="checkbox" id="js_mode_toggle" />
				<span class="switch-mode" id="js_rotate"></span>
			</label>
		</div>

		<script>
			// è¦ç´ ã‚„ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã—ã¦ãŠã
			const checkToggle = document.getElementById("js_mode_toggle");
			const rotateIcon = document.getElementById("js_rotate");
			const classLight = "js-mode-light";

			// ãƒ‡ãƒã‚¤ã‚¹ãŒãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯
			const isLight = window.matchMedia(
				"(prefers-color-scheme: light)"
			).matches;

			// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®é©å½“ãªKeyå
			const keyLocalStorage = "whike-theme-mode";

			// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æƒ…å ±ã‚’å–å¾—
			const localTheme = localStorage.getItem(keyLocalStorage);

			// çµµæ–‡å­—ã‚’å›è»¢ã•ã›ã‚‹è§’åº¦
			let nowRotate = 0;

			// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä¸­èº«ã¨ã€ç«¯æœ«ãŒãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ï¼ˆie,edgeã«ã¯ç„¡æ„å‘³ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯
			if (localTheme === "light") {
				// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æƒ…å ±ãŒå„ªå…ˆ
				rotateInfinite();
				changeMode("light");
			} else if (localTheme === "dark") {
				changeMode("dark");
			} else if (isLight) {
				rotateInfinite();
				changeMode("light");
			}

			// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ã®åˆ‡ã‚Šæ›¿ãˆã€é¸æŠã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
			// ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã‚¹ã‚¤ãƒƒãƒãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ç™ºå‹•
			checkToggle.addEventListener("change", function (e) {
				// çµµæ–‡å­—å¤§å›è»¢
				rotateInfinite();

				// ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã•ã‚Œãªã‘ã‚Œã°ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã©ã¡ã‚‰ã‚’é¸ã‚“ã ã‹ä¿å­˜ã™ã‚‹
				if (e.target.checked) {
					changeMode("light");
					localStorage.setItem(keyLocalStorage, "light");
				} else {
					changeMode("dark");
					localStorage.setItem(keyLocalStorage, "dark");
				}
			});

			/**
			 * ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
			 * @param {String} mode 'light' ã‚‚ã—ãã¯ 'dark'
			 */
			function changeMode(mode) {
				// å¼•æ•°ã«ã—ãŸãŒã£ã¦bodyã«ã‚¯ãƒ©ã‚¹ã‚’ã¤ã‘ã‚‹
				// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹çµŒç”±ã§å¤‰æ›´ã‹ã‹ã£ãŸã¨ãã¯ã„ã„ã‚“ã ã‘ã©ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã‹ã‹ã‚‰ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰ãˆãŸå ´åˆã«ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ãŒãŠã‹ã—ããªã‚‹ã®ã§ã€åˆã‚ã›ã¦ãŠã
				if (mode === "light") {
					document.body.classList.add(classLight);
					checkToggle.checked = true;
				} else if (mode === "dark") {
					document.body.classList.remove(classLight);
					checkToggle.checked = false;
				}
			}

			/**
			 * æœˆã¨å¤ªé™½ã‚¢ã‚¤ã‚³ãƒ³ç„¡é™å›è»¢
			 * å‘¼ã°ã‚Œã‚‹ãŸã³ã«180åº¦è§’åº¦ãŒè¿½åŠ ã•ã‚Œã¦ã„ã
			 */
			function rotateInfinite() {
				nowRotate += 180;
				rotateIcon.style.transform = "rotate(" + nowRotate + "deg)";
			}
		</script>
	</body>
</html>
